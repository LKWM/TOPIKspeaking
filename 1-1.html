<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Question 1 - Answering Questions</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&family=Noto+Sans:wght@300;400;500;700&display=swap');

        body {
            font-family: 'Noto Sans', 'Noto Sans KR', sans-serif;
            background-color: #f3f4f6;
            overflow: hidden;
            touch-action: manipulation;
        }

        .slide-enter { animation: slideIn 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Responsive Fluid Text */
        .text-fluid-xs { font-size: clamp(0.75rem, 1.5vh, 1rem); }
        .text-fluid-sm { font-size: clamp(0.875rem, 2vh, 1.25rem); }
        .text-fluid-base { font-size: clamp(1rem, 2.5vh, 1.5rem); }
        .text-fluid-lg { font-size: clamp(1.25rem, 3.5vh, 2.25rem); }
        .text-fluid-xl { font-size: clamp(1.75rem, 5vh, 4rem); }
    </style>
</head>
<body class="h-screen w-screen flex items-center justify-center bg-slate-100 text-slate-800 md:p-4">

    <!-- Main Container -->
    <div id="app-container" class="relative w-full h-full bg-white md:rounded-2xl shadow-2xl overflow-hidden flex flex-col max-w-[1920px] mx-auto">
        
        <!-- Header / Progress -->
        <div class="h-1.5 w-full bg-slate-100 shrink-0">
            <div id="progress-bar" class="h-full bg-indigo-500 transition-all duration-500 ease-out" style="width: 0%"></div>
        </div>

        <!-- Content Area -->
        <main id="content-area" class="flex-grow flex flex-col items-center justify-center p-6 md:p-10 relative overflow-hidden">
            <!-- Dynamic Content -->
        </main>

        <!-- Footer / Navigation -->
        <footer class="h-[10vh] max-h-20 w-full bg-white border-t border-slate-100 flex items-center justify-between px-6 md:px-10 z-10 shrink-0">
            <button id="prev-btn" class="flex items-center gap-2 text-slate-500 hover:text-indigo-600 font-medium transition-colors opacity-0 pointer-events-none">
                <i data-lucide="arrow-left" class="w-[2.5vh] h-[2.5vh]"></i>
                <span class="hidden md:inline text-fluid-sm">Précédent</span>
            </button>

            <div class="text-xs md:text-sm text-slate-300 font-medium tracking-widest absolute left-1/2 transform -translate-x-1/2 pointer-events-none">CORÉENO</div>

            <button id="next-btn" class="group flex items-center gap-2 px-6 py-3 bg-indigo-600 hover:bg-indigo-700 text-white rounded-full font-semibold transition-all active:scale-95 shadow-lg shadow-indigo-200 disabled:opacity-50 text-fluid-sm">
                <span>Suivant</span>
                <i data-lucide="arrow-right" class="w-[2.5vh] h-[2.5vh] group-hover:translate-x-1 transition-transform"></i>
            </button>
        </footer>
    </div>

    <!-- Hidden Audio Player -->
    <audio id="lesson-audio" class="hidden"></audio>

    <script>
        // --- Data ---
        const slides = [
            {
                type: 'cover',
                title: "문항 1 - 질문에 대답하기",
                subtitle: "Question 1 - Répondre aux questions"
            },
            {
                type: 'text',
                content: `
                    <div class="flex flex-col items-center justify-center h-full w-full gap-[5vh]">
                        <p class="text-fluid-lg leading-relaxed text-slate-700 text-center max-w-4xl px-4">
                            La <span class="font-bold text-indigo-600">Question 1</span> consiste à écouter une question et à y répondre. Le sujet porte sur des thèmes simples de la vie quotidienne.
                        </p>
                        <div class="flex flex-row gap-[4vw] justify-center items-center w-full">
                            <div class="bg-indigo-50 px-[4vw] py-[3vh] rounded-3xl flex flex-col items-center gap-2 shadow-sm border border-indigo-100">
                                <i data-lucide="hourglass" class="text-indigo-500 w-[6vh] h-[6vh]"></i>
                                <p class="text-fluid-sm text-indigo-400 font-bold uppercase tracking-wider mt-1">Préparation</p>
                                <p class="text-fluid-xl font-black text-indigo-700 leading-none">20<span class="text-fluid-lg">s</span></p>
                            </div>
                            <div class="bg-indigo-50 px-[4vw] py-[3vh] rounded-3xl flex flex-col items-center gap-2 shadow-sm border border-indigo-100">
                                <i data-lucide="mic" class="text-indigo-500 w-[6vh] h-[6vh]"></i>
                                <p class="text-fluid-sm text-indigo-400 font-bold uppercase tracking-wider mt-1">Réponse</p>
                                <p class="text-fluid-xl font-black text-indigo-700 leading-none">30<span class="text-fluid-lg">s</span></p>
                            </div>
                        </div>
                    </div>
                `
            },
            {
                type: 'example',
                title: "Contenu des questions",
                content: "Les questions portent sur vous-même, vos proches, des objets, votre quotidien, vos expériences passées ou vos projets futurs. Vous devez écouter attentivement pour bien comprendre ce qui est demandé.",
                audioSrc: "https://res.cloudinary.com/de76i94ia/video/upload/v1767782322/Q_ex_1_vaj6tr.mp3", 
                koreanText: "가장 친한 친구가 누구예요? 그 친구에 대해 이야기하세요.",
                badge: "Exemple de question"
            },
            {
                type: 'example',
                title: "Stratégie de préparation",
                content: "Pendant les 20 secondes de préparation, organisez vos idées et planifiez les détails. Le temps étant court, n'écrivez pas de phrases complètes. <span class='font-bold text-indigo-600'>Notez des mots-clés</span> et utilisez-les pour parler.",
                audioSrc: "", 
                koreanText: "가장 친한 친구, 민수, 고등학교, 친절하다, 키가 크다",
                badge: "Mots-clés (Notes)"
            },
            {
                type: 'example',
                title: "Conseils de préparation (Débutant)",
                content: "Visez 2 à 3 phrases correctes en utilisant la grammaire de base. Utilisez vos mots-clés pour construire des phrases simples.",
                audioSrc: "https://res.cloudinary.com/de76i94ia/video/upload/v1767782323/R_ex_1_1_ef25g9.mp3", 
                koreanText: "제 가장 친한 친구는 민수예요. 저는 고등학교에서 민수를 만났어요. 민수는 친절하고 키가 커요.",
                badge: "Exemple de réponse (Débutant)",
                levelColor: "bg-green-100 text-green-700 border-green-200"
            },
            {
                type: 'example',
                title: "Conseils de préparation (Intermédiaire)",
                content: "Entraînez-vous à faire 4 à 5 phrases plus longues en utilisant des propositions subordonnées et des connecteurs. Un vocabulaire varié aide à obtenir un meilleur score.",
                audioSrc: "https://res.cloudinary.com/de76i94ia/video/upload/v1767782326/R_ex_1_2_chleqe.mp3", 
                koreanText: "저는 고등학교 때 민수와 같은 반이었어요. 그때는 별로 친하지 않았지만 같은 대학교에 가면서 아주 가까워졌어요. 민수는 친절하고 키도 커서 친구들에게 인기가 많았고 공부도 정말 잘했어요.",
                badge: "Exemple de réponse (Intermédiaire)",
                levelColor: "bg-blue-100 text-blue-700 border-blue-200"
            },
            {
                type: 'example',
                title: "Conseils de préparation (Avancé)",
                content: "Utilisez différents temps et construisez un discours cohérent de plus de 6 phrases. Privilégiez une prononciation naturelle et une structure logique plutôt qu'un vocabulaire trop complexe et artificiel.",
                audioSrc: "https://res.cloudinary.com/de76i94ia/video/upload/v1767782330/R_ex_1_3_fpyxg8.mp3", 
                koreanText: "저는 고등학교 1학년 때 학교에 아는 사람이 많지 않아서 주로 혼자 시간을 보냈어요. 그런데 같은 반에 있던 민수라는 친구가 저에게 먼저 말을 걸어줬어요. 우리는 같이 점심도 먹고 농구도 자주 하면서 점점 더 가까워졌어요. 민수는 키가 커서 농구를 정말 잘했기 때문에 다른 친구들에게도 인기가 많았어요. 저는 민수 덕분에 많은 친구들을 사귈 수 있었고, 어른이 된 지금도 민수는 제 가장 친한 친구예요.",
                badge: "Exemple de réponse (Avancé)",
                levelColor: "bg-purple-100 text-purple-700 border-purple-200"
            },
            {
                type: 'outro',
                content: `
                    <div class="flex flex-col items-center justify-center h-full gap-[3vh] px-4">
                        <div class="p-[3vh] bg-indigo-50 rounded-full shadow-sm">
                            <i data-lucide="check-circle-2" class="w-[8vh] h-[8vh] text-indigo-600"></i>
                        </div>
                        <p class="text-fluid-lg text-slate-600 leading-relaxed text-center max-w-4xl">
                            Maintenant, analysons ensemble les différentes questions de la <br><span class="font-bold text-indigo-600">&lt;Question 1&gt;</span> dans l'<span class="font-bold text-indigo-600">&lt;Exercice 1&gt;</span> !
                        </p>
                    </div>
                `
            }
        ];

        let currentIndex = 0;
        let isAudioInitialized = false;

        const contentArea = document.getElementById('content-area');
        const nextBtn = document.getElementById('next-btn');
        const prevBtn = document.getElementById('prev-btn');
        const progressBar = document.getElementById('progress-bar');
        const audioEl = document.getElementById('lesson-audio');

        async function initAudio() {
            if (isAudioInitialized) return;
            await Tone.start();
            isAudioInitialized = true;
        }

        function playSound(type) {
            if (!isAudioInitialized) return;
            const synth = new Tone.MembraneSynth().toDestination();
            const melodySynth = new Tone.Synth().toDestination();

            switch(type) {
                case 'click': synth.triggerAttackRelease("C2", "32n"); break;
                case 'complete': 
                    const now = Tone.now();
                    melodySynth.triggerAttackRelease("C5", "8n", now);
                    melodySynth.triggerAttackRelease("E5", "8n", now + 0.1);
                    melodySynth.triggerAttackRelease("G5", "8n", now + 0.2);
                    melodySynth.triggerAttackRelease("C6", "4n", now + 0.3);
                    break;
            }
        }

        function toggleLessonAudio(src, btnId) {
            const btn = document.getElementById(btnId);
            if (!src) return;

            if (audioEl.src !== src) {
                audioEl.src = src;
                audioEl.load();
            }

            if (audioEl.paused) {
                audioEl.play();
                btn.innerHTML = `<i data-lucide="pause" class="w-full h-full text-white p-2"></i>`;
                lucide.createIcons();
            } else {
                audioEl.pause();
                btn.innerHTML = `<i data-lucide="play" class="w-full h-full text-white p-2 ml-1"></i>`;
                lucide.createIcons();
            }

            audioEl.onended = () => {
                btn.innerHTML = `<i data-lucide="play" class="w-full h-full text-white p-2 ml-1"></i>`;
                lucide.createIcons();
            };
        }

        function updateProgress() {
            progressBar.style.width = `${((currentIndex + 1) / slides.length) * 100}%`;
        }

        function updateNavigation() {
            if (currentIndex === 0) prevBtn.classList.add('opacity-0', 'pointer-events-none');
            else prevBtn.classList.remove('opacity-0', 'pointer-events-none');

            if (currentIndex === slides.length - 1) {
                 nextBtn.innerHTML = `<span>Terminer</span> <i data-lucide="check" class="w-[2.5vh] h-[2.5vh]"></i>`;
                 nextBtn.className = "group flex items-center gap-2 px-6 py-3 bg-green-500 hover:bg-green-600 text-white rounded-full font-semibold transition-all shadow-lg shadow-green-200 text-fluid-sm";
            } else {
                 nextBtn.innerHTML = `<span>Suivant</span> <i data-lucide="arrow-right" class="w-[2.5vh] h-[2.5vh] group-hover:translate-x-1 transition-transform"></i>`;
                 nextBtn.className = "group flex items-center gap-2 px-6 py-3 bg-indigo-600 hover:bg-indigo-700 text-white rounded-full font-semibold transition-all active:scale-95 shadow-lg shadow-indigo-200 text-fluid-sm";
            }
        }

        function renderSlide(index) {
            audioEl.pause();
            audioEl.currentTime = 0;

            const slide = slides[index];
            contentArea.innerHTML = ''; 

            const container = document.createElement('div');
            container.className = 'w-full h-full flex flex-col items-center slide-enter';

            // Justify-center for cover to match Exercise 1
            if (slide.type === 'cover') {
                container.classList.add('justify-center', 'gap-[4vh]');
                container.innerHTML = `
                    <div class="flex flex-col items-center justify-center gap-[4vh] h-full pb-[10vh]">
                        <div class="p-[3vh] bg-indigo-50 rounded-full shrink-0 shadow-sm">
                            <i data-lucide="mic-2" class="w-[10vh] h-[10vh] text-indigo-600"></i>
                        </div>
                        <div class="text-center">
                            <h1 class="text-fluid-xl font-black text-center text-slate-800 mb-[2vh] leading-tight tracking-tight">${slide.title}</h1>
                            <p class="text-fluid-lg text-slate-500 font-medium text-center">${slide.subtitle}</p>
                        </div>
                    </div>
                `;
                nextBtn.innerHTML = `<span>Commencer</span> <i data-lucide="arrow-right" class="w-[2.5vh] h-[2.5vh]"></i>`;
            } 
            else if (slide.type === 'text' || slide.type === 'outro') {
                container.classList.add('justify-evenly');
                if (slide.title) {
                    container.innerHTML = `<h2 class="text-fluid-xl font-bold text-slate-800 text-center">${slide.title}</h2>`;
                }
                container.innerHTML += `<div class="w-full flex-grow flex flex-col justify-center">${slide.content}</div>`;
            }
            else if (slide.type === 'example') {
                container.classList.add('justify-between'); 
                const btnId = `play-btn-${index}`;
                const hasAudio = slide.audioSrc && slide.audioSrc.length > 0;
                
                // Top Title
                if (slide.title) {
                    container.innerHTML += `<h2 class="text-fluid-lg font-bold text-slate-800 text-center mb-[2vh] shrink-0">${slide.title}</h2>`;
                } else {
                    container.innerHTML += `<div class="h-[2vh] shrink-0"></div>`; 
                }

                // Middle Content (Instruction)
                container.innerHTML += `
                    <div class="flex-grow flex items-center justify-center px-4 mb-[2vh]">
                        <p class="text-fluid-base text-slate-600 text-center leading-relaxed max-w-5xl">
                            ${slide.content}
                        </p>
                    </div>
                `;

                // Bottom Content (Card)
                // Using flex-grow-0 to keep it from taking too much space, max-height relative to vh
                container.innerHTML += `
                    <div class="w-full bg-white rounded-2xl shadow-xl border border-slate-200 overflow-hidden flex flex-col shrink-0 h-[45vh] md:h-[50vh] mb-[2vh]">
                        <div class="px-6 py-3 bg-slate-50 flex items-center justify-between shrink-0 border-b border-slate-100 h-[8vh]">
                            <span class="text-fluid-sm font-bold uppercase tracking-wider text-slate-500 flex items-center gap-2">
                                <i data-lucide="file-text" class="w-[2.5vh] h-[2.5vh]"></i>
                                ${slide.badge}
                            </span>
                            ${hasAudio ? `
                            <button id="${btnId}" 
                                class="w-[6vh] h-[6vh] rounded-full flex items-center justify-center bg-indigo-500 hover:bg-indigo-600 transition-all shadow-md active:scale-95"
                                onclick="toggleLessonAudio('${slide.audioSrc}', '${btnId}')">
                                <i data-lucide="play" class="w-[2.5vh] h-[2.5vh] text-white ml-0.5"></i>
                            </button>
                            ` : ''}
                        </div>
                        <div class="p-6 md:p-8 ${slide.levelColor ? slide.levelColor : 'bg-slate-50'} flex-grow flex items-center justify-center text-center overflow-y-auto">
                            <p class="text-fluid-lg font-medium leading-relaxed text-slate-800 keep-all">
                                "${slide.koreanText}"
                            </p>
                        </div>
                    </div>
                `;
            }

            contentArea.appendChild(container);
            updateNavigation(); 
            lucide.createIcons();
        }

        nextBtn.addEventListener('click', async () => {
            if (!isAudioInitialized) await initAudio();
            if (currentIndex === slides.length - 1) {
                playSound('complete');
                window.parent.postMessage({ type: 'lesson_complete' }, '*');
                nextBtn.disabled = true;
                nextBtn.innerHTML = `<span>Terminé !</span>`;
                return;
            }
            playSound('click');
            currentIndex++;
            renderSlide(currentIndex);
            updateProgress();
        });

        prevBtn.addEventListener('click', () => {
             if (currentIndex > 0) {
                 currentIndex--;
                 renderSlide(currentIndex);
                 updateProgress();
             }
        });

        renderSlide(currentIndex);
        updateProgress();
        window.toggleLessonAudio = toggleLessonAudio;
    </script>
</body>
</html>
