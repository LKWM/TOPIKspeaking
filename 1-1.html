<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Question 1 - Répondre aux questions</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/phosphor-icons"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&family=Nunito:wght@400;600;700&display=swap');

        /* 1. 기본 설정 */
        body {
            font-family: 'Nunito', 'Noto Sans KR', sans-serif;
            overflow: hidden;
            background-color: #F3F4F6;
            touch-action: none;
            user-select: none;
            -webkit-user-select: none;
            height: 100vh;
            width: 100vw;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0;
            padding: 0;
        }

        /* 2. 메인 컨테이너 */
        #app-container {
            width: 100%;
            height: 100%;
            max-width: 1024px;
            max-height: 900px;
            background-color: white;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        @media (min-width: 640px) and (min-height: 640px) {
            #app-container {
                border-radius: 1rem;
                height: 95vh;
                width: 95vw;
            }
        }

        /* 3. 콘텐츠 영역 (Flex Gap 기반 균일 배치) */
        .slide-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center; 
            align-items: center;
            text-align: center;
            padding: 4vh 1.5rem; 
            /* 모든 요소 사이의 간격을 일정하게 유지 (마진 대신 사용) */
            gap: 3vh; 
            width: 100%;
            height: 100%;
            overflow: hidden; 
        }

        @media (max-width: 640px) {
            .slide-content {
                padding: 3vh 1.25rem; 
                gap: 2.5vh;
            }
        }

        /* 4. 커스텀 오디오 버튼 */
        .custom-audio-btn {
            width: 3.5rem; 
            height: 3.5rem;
            border-radius: 50%;
            background-color: #4F46E5;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: all 0.2s ease;
            border: none;
            outline: none;
            flex-shrink: 0; 
        }

        @media (min-width: 640px) {
            .custom-audio-btn {
                width: 4.5rem;
                height: 4.5rem;
                font-size: 2rem;
            }
        }

        .custom-audio-btn:active { transform: scale(0.95); box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); }
        .custom-audio-btn.playing {
            background-color: #E0E7FF;
            color: #4F46E5;
            cursor: not-allowed;
            pointer-events: none;
            animation: pulse 1.5s infinite;
            transform: none;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(79, 70, 229, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(79, 70, 229, 0); }
            100% { box-shadow: 0 0 0 0 rgba(79, 70, 229, 0); }
        }

        /* 5. 텍스트 박스 스타일 (완벽한 중앙 정렬) */
        .korean-example {
            background-color: #FFFFFF;
            border-left: 4px solid #6366F1;
            /* 내부 패딩을 상하 동일하게 설정 */
            padding: 1.5rem; 
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 600px;
            margin: 0 auto; 
            text-align: center; /* 텍스트 중앙 정렬 강제 */
            
            /* 내부 요소 정렬 */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            /* 내부 요소 간 간격 (제목과 본문 사이) */
            gap: 1rem; 

            max-height: none; 
            flex-shrink: 1;
            overflow: visible; 
        }
        
        @media (min-width: 640px) {
            .korean-example { padding: 2rem; }
        }

        /* 6. 반응형 텍스트 유틸리티 */
        .responsive-title {
            font-size: clamp(1.1rem, 2.5vh, 1.8rem);
            font-weight: 700;
            color: #1F2937;
            /* 마진 제거 (Gap으로 제어) */
            margin: 0;
            line-height: 1.3;
        }

        .responsive-text {
            font-size: clamp(0.85rem, 1.8vh, 1.2rem);
            color: #4B5563;
            line-height: 1.4;
            max-width: 42rem;
            word-break: keep-all;
            margin: 0; /* 마진 제거 */
        }

        .responsive-example-text {
            font-size: clamp(0.8rem, 1.8vh, 1.25rem); 
            font-weight: 500;
            color: #1F2937;
            font-family: 'Noto Sans KR', sans-serif;
            word-break: keep-all;
            line-height: 1.8;
            text-align: center; /* 텍스트 중앙 정렬 */
            width: 100%;
        }

        .example-label {
            font-size: 0.75rem;
            font-weight: 700;
            color: #6366F1;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-bottom: 1px solid #E0E7FF;
            padding-bottom: 0.25rem;
            display: inline-block;
            margin: 0; /* 마진 제거 */
        }
        @media (min-width: 640px) {
            .example-label { font-size: 0.85rem; }
        }

    </style>
</head>
<body>

    <div id="app-container">
        <!-- 헤더: 진행바 -->
        <div class="h-1.5 sm:h-2 bg-gray-200 w-full flex-shrink-0">
            <div id="progress-bar" class="h-full bg-indigo-500 transition-all duration-300" style="width: 0%"></div>
        </div>

        <!-- 메인 컨텐츠 영역 -->
        <div id="content-area" class="w-full relative overflow-hidden flex-1">
            <!-- 자바스크립트로 내용 주입 -->
        </div>

        <!-- 네비게이션 -->
        <div id="navigation" class="h-16 sm:h-20 bg-gray-50 border-t border-gray-200 flex items-center justify-between px-4 sm:px-6 hidden z-10 flex-shrink-0">
            <button id="prev-btn" class="flex items-center text-gray-500 hover:text-indigo-600 font-bold transition-colors disabled:opacity-30 disabled:cursor-not-allowed select-none text-sm sm:text-base">
                <i class="ph ph-caret-left text-lg sm:text-2xl mr-1 sm:mr-2"></i> Précédent
            </button>
            <div class="flex-1"></div>
            <button id="next-btn" class="flex items-center text-indigo-600 hover:text-indigo-800 font-bold transition-colors select-none text-sm sm:text-base">
                Suivant <i class="ph ph-caret-right text-lg sm:text-2xl ml-1 sm:ml-2"></i>
            </button>
        </div>
    </div>

    <script>
        // --- 데이터 ---
        const slides = [
            {
                type: 'cover',
                title: "문항 1 - 질문에 대답하기",
                subtitle: "Question 1 - Répondre aux questions",
                content: ""
            },
            {
                type: 'content',
                content: "La Question 1 consiste à écouter une question et à y répondre.<br><br>Les questions portent sur des sujets simples de la vie quotidienne. Après avoir écouté la question, vous disposez de <strong>20 secondes de préparation</strong>. Une fois les 20 secondes écoulées, vous devez <strong>répondre pendant 30 secondes</strong>."
            },
            {
                type: 'example',
                content: "Les questions portent sur vous-même, vos proches, des objets, votre quotidien, vos expériences passées ou vos projets futurs.<br>Vous devez écouter attentivement pour comprendre exactement ce qui est demandé.",
                audio: "https://res.cloudinary.com/de76i94ia/video/upload/v1767782322/Q_ex_1_vaj6tr.mp3",
                exampleTitle: "Exemple de question",
                exampleText: "가장 친한 친구가 누구예요? 그 친구에 대해 이야기하세요."
            },
            {
                type: 'example',
                content: "Pendant les 20 secondes de préparation, vous pouvez organiser et résumer ce que vous allez dire. Vous devez planifier les détails liés au sujet.<br><br>Comme le temps de préparation est court, vous ne pouvez pas écrire tout votre discours. Vous devez noter des mots-clés et être capable de parler directement en les utilisant.",
                exampleTitle: "Exemple de mots-clés",
                exampleText: "가장 친한 친구, 민수, 고등학교, 친절하다, 키가 크다"
            },
            {
                type: 'example',
                title: "Conseils de préparation - Débutant",
                content: "Le discours réel se déroule pendant 30 secondes en regardant les mots-clés préparés.<br><br>Visez à dire correctement 2 à 3 phrases en respectant la grammaire de base.",
                audio: "https://res.cloudinary.com/de76i94ia/video/upload/v1767782323/R_ex_1_1_ef25g9.mp3",
                exampleTitle: "Exemple de réponse",
                exampleText: "제 가장 친한 친구는 민수예요. 저는 고등학교에서 민수를 만났어요. 민수는 친절하고 키가 커요."
            },
            {
                type: 'example',
                title: "Conseils de préparation - Intermédiaire",
                content: "Il est bon de s'entraîner à dire environ 4 à 5 phrases un peu plus longues en utilisant des phrases enchâssées et des conjonctions.<br>L'utilisation d'un vocabulaire plus varié aide également à obtenir un score élevé.",
                audio: "https://res.cloudinary.com/de76i94ia/video/upload/v1767782326/R_ex_1_2_chleqe.mp3",
                exampleTitle: "Exemple de réponse",
                exampleText: "저는 고등학교 때 민수와 같은 반이었어요. 그때는 별로 친하지 않았지만 같은 대학교에 가면서 아주 가까워졌어요. 민수는 친절하고 키도 커서 친구들에게 인기가 많았고 공부도 정말 잘했어요."
            },
            {
                type: 'content',
                title: "Conseils de préparation - Avancé",
                content: "Si vous êtes un locuteur de niveau avancé, vous devez être capable d'utiliser divers temps verbaux à la Question 1 et de parler de manière longue et cohérente avec plus de 6 phrases.<br><br>Comme il s'agit d'un contenu quotidien, une prononciation naturelle et une structure cohérente sont plus importantes que d'essayer d'utiliser un vocabulaire artificiellement complexe."
            },
            {
                type: 'example',
                content: "Écoutez cet exemple de réponse de niveau avancé.",
                audio: "https://res.cloudinary.com/de76i94ia/video/upload/v1767782330/R_ex_1_3_fpyxg8.mp3",
                exampleTitle: "Exemple de réponse",
                exampleText: "저는 고등학교 1학년 때 학교에 아는 사람이 많지 않아서 주로 혼자 시간을 보냈어요. 그런데 같은 반에 있던 민수라는 친구가 저에게 먼저 말을 걸어줬어요. 우리는 같이 점심도 먹고 농구도 자주 하면서 점점 더 가까워졌어요. 민수는 키가 커서 농구를 정말 잘했기 때문에 다른 친구들에게도 인기가 많았어요. 저는 민수 덕분에 많은 친구들을 사귈 수 있었고, 어른이 된 지금도 민수는 제 가장 친한 친구예요."
            },
            {
                type: 'outro',
                title: "", 
                content: "Maintenant, passons à l'exercice 1 pour analyser les différentes questions du type 1 !"
            }
        ];

        // --- 상태 관리 ---
        let currentIndex = 0;
        let completionSynth = null;
        let clickSynth = null;
        let audioContextStarted = false;
        let currentAudio = null;
        let currentBtn = null;
        let hasOutroPlayed = false;

        // --- DOM 요소 ---
        const appContainer = document.getElementById('app-container');
        const contentArea = document.getElementById('content-area');
        const navigation = document.getElementById('navigation');
        const progressBar = document.getElementById('progress-bar');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');

        // --- 초기화 ---
        async function initAudio() {
            if (!audioContextStarted) {
                await Tone.start();
                completionSynth = new Tone.PolySynth(Tone.Synth).toDestination();
                clickSynth = new Tone.MembraneSynth({
                    pitchDecay: 0.008,
                    octaves: 2,
                    oscillator: { type: "sine" },
                    envelope: {
                        attack: 0.001,
                        decay: 0.1,
                        sustain: 0,
                        release: 0.1,
                        attackCurve: "exponential"
                    }
                }).toDestination();
                audioContextStarted = true;
            }
        }

        function playClickSound() {
            if (clickSynth && audioContextStarted) {
                clickSynth.triggerAttackRelease("F4", "32n"); 
            }
        }

        // --- 렌더링 로직 ---
        function renderSlide(index) {
            stopCurrentAudio();

            const slide = slides[index];
            const isLastPage = index === slides.length - 1;
            
            // 프로그레스 바 업데이트
            const progress = ((index + 1) / slides.length) * 100;
            progressBar.style.width = `${progress}%`;

            // HTML 생성
            let html = '';
            
            if (slide.type === 'cover') {
                navigation.classList.add('hidden');
                html = `
                    <div class="slide-content fade-in">
                        <div class="flex-1 flex flex-col justify-center items-center w-full h-full" style="gap: 2rem;">
                            <div class="bg-indigo-100 p-4 sm:p-6 rounded-full flex-shrink-0">
                                <i class="ph-fill ph-chat-circle-text text-5xl sm:text-6xl text-indigo-600"></i>
                            </div>
                            <div class="text-center">
                                <h1 class="text-2xl sm:text-4xl font-extrabold text-gray-900 mb-2 sm:mb-4 px-2 break-keep">${slide.title}</h1>
                                <p class="text-lg sm:text-xl text-gray-600 font-medium px-4">${slide.subtitle}</p>
                            </div>
                            
                            <button onclick="startLesson()" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-8 sm:px-10 rounded-full shadow-lg transform transition hover:scale-105 flex items-center text-base sm:text-lg flex-shrink-0">
                                Commencer <i class="ph-bold ph-arrow-right ml-2"></i>
                            </button>
                        </div>
                    </div>
                `;
            } else {
                navigation.classList.remove('hidden');
                
                let innerContent = '';

                // 타이틀
                if (slide.title) {
                    innerContent += `<h2 class="responsive-title text-center flex-shrink-0">${slide.title}</h2>`;
                }

                // Outro 페이지
                if (slide.type === 'outro') {
                    innerContent += `
                        <div class="flex flex-col items-center justify-center w-full h-full" style="gap: 2rem;">
                             <div class="text-indigo-600 font-semibold flex flex-col items-center animate-bounce">
                                <i class="ph-fill ph-star text-5xl sm:text-6xl"></i>
                            </div>
                            <p class="responsive-text font-medium text-center px-4">${slide.content}</p>
                        </div>
                    `;
                } else {
                    // 설명 텍스트
                    innerContent += `<p class="responsive-text px-2">${slide.content}</p>`;

                    // 오디오 버튼
                    if (slide.audio) {
                        innerContent += `
                            <div class="flex flex-col items-center flex-shrink-0">
                                <button id="audio-btn-${index}" class="custom-audio-btn" onclick="playAudio('${slide.audio}', 'audio-btn-${index}')">
                                    <i class="ph-fill ph-play"></i>
                                </button>
                                <p class="text-xs text-gray-400 mt-2 font-medium">Écouter</p>
                            </div>
                        `;
                    }

                    // 예시 텍스트 박스
                    if (slide.exampleText) {
                        innerContent += `
                            <div class="korean-example flex-shrink-1">
                                <div class="example-label">${slide.exampleTitle || 'Exemple'}</div>
                                <div class="responsive-example-text">
                                    ${slide.exampleText}
                                </div>
                            </div>
                        `;
                    }
                }

                html = `<div class="slide-content fade-in w-full">${innerContent}</div>`;
            }

            contentArea.innerHTML = html;
            
            prevBtn.disabled = index === 0;
            
            if (isLastPage) {
                nextBtn.innerHTML = `Terminer <i class="ph ph-check text-lg sm:text-2xl ml-1 sm:ml-2"></i>`;
                playCompletion();
            } else {
                nextBtn.innerHTML = `Suivant <i class="ph ph-caret-right text-lg sm:text-2xl ml-1 sm:ml-2"></i>`;
            }
        }

        // --- 오디오 및 기능 로직 (변경 없음) ---
        function stopCurrentAudio() {
            if (currentAudio) {
                currentAudio.pause();
                currentAudio = null;
            }
            if (currentBtn) {
                currentBtn.innerHTML = '<i class="ph-fill ph-play"></i>';
                currentBtn.classList.remove('playing');
                currentBtn = null;
            }
        }

        function playAudio(src, btnId) {
            const btn = document.getElementById(btnId);
            if (currentBtn === btn) return;

            stopCurrentAudio();
            const audio = new Audio(src);
            
            audio.onended = () => {
                btn.innerHTML = '<i class="ph-fill ph-play"></i>';
                btn.classList.remove('playing');
                currentAudio = null;
                currentBtn = null;
            };
            audio.play().catch(e => console.error("Audio play error:", e));
            currentAudio = audio;
            currentBtn = btn;
            btn.innerHTML = '<i class="ph-fill ph-speaker-high"></i>';
            btn.classList.add('playing');
        }

        function playCompletion() {
            if (hasOutroPlayed) return;
            if (completionSynth && audioContextStarted) {
                completionSynth.triggerAttackRelease(["C5", "E5", "G5", "C6"], "4n");
            }
            window.parent.postMessage({ type: 'lesson_complete' }, '*');
            hasOutroPlayed = true;
        }

        async function startLesson() {
            await initAudio(); 
            nextSlide();
        }

        function nextSlide() {
            if (currentIndex < slides.length - 1) {
                playClickSound();
                currentIndex++;
                renderSlide(currentIndex);
            }
        }

        function prevSlide() {
            if (currentIndex > 0) {
                playClickSound();
                currentIndex--;
                if (hasOutroPlayed) hasOutroPlayed = false;
                renderSlide(currentIndex);
            }
        }

        renderSlide(0);

        prevBtn.addEventListener('click', prevSlide);
        nextBtn.addEventListener('click', nextSlide);

        window.startLesson = startLesson;
        window.playAudio = playAudio;
        window.nextSlide = nextSlide; 
    </script>
</body>
</html>
